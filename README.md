# SHEild Backend

The **SHEild Backend** is a robust Node.js/Express application designed to support the SHEild Women's Safety App. Its primary role is to verify authentication tokens issued by Appwrite, manage user sessions via custom JWTs, and handle additional verification logic and data storage using MongoDB.

## Features

- **Appwrite Integration**: Verifies user identity using Appwrite's server-side SDK.
- **Custom Authentication**: Issues custom JWTs for secure session management after Appwrite verification.
- **User Management**: Manages user data in a MongoDB database.
- **Safety Logic**: (Planned) Backend logic for safety checks and verification.

## Prerequisites

Before you begin, ensure you have the following installed:

- [Node.js](https://nodejs.org/) (v16 or higher recommended)
- [npm](https://www.npmjs.com/) or [yarn](https://yarnpkg.com/)
- An active [Appwrite](https://appwrite.io/) instance (Cloud or Self-hosted)
- A [MongoDB](https://www.mongodb.com/) database

## Installation

1.  **Clone the repository:**
    ```bash
    git clone <repository_url>
    cd sheild_api_server
    ```

2.  **Install dependencies:**
    ```bash
    npm install
    ```

## Configuration

Create a `.env` file in the root directory of the project and configure the following environment variables:

```env
# Server Configuration
PORT=5000

# Database
MONGO_URI=mongodb://localhost:27017/sheild_db

# Appwrite Configuration
APPWRITE_ENDPOINT=https://cloud.appwrite.io/v1 # or your self-hosted endpoint
APPWRITE_PROJECT_ID=your_project_id
APPWRITE_API_KEY=your_appwrite_server_api_key

# JWT Configuration
JWT_SECRET=your_super_secret_jwt_key

# Optional: AI & Logging (if applicable)
LOG_LEVEL=info
```

### Environment Variable Details

- `PORT`: The port on which the server will run (default: 5000).
- `MONGO_URI`: Connection string for your MongoDB database.
- `APPWRITE_ENDPOINT`: The API endpoint for your Appwrite instance.
- `APPWRITE_PROJECT_ID`: Your Appwrite project ID.
- `APPWRITE_API_KEY`: A server-side API key from Appwrite with appropriate scopes (e.g., `users.read`).
- `JWT_SECRET`: A strong secret key used to sign and verify custom backend JWTs.

## Running the Server

### Development Mode
Runs the server with `nodemon` for hot-reloading:
```bash
npm run dev
```

### Production Mode
Builds and runs the compiled JavaScript:
```bash
npm run build
npm start
```

## API Documentation

### Authentication

#### Verify Appwrite Token & Login
Exchanges an Appwrite client JWT for a custom backend session token.

- **Endpoint**: `POST /v1/auth/jwtVerify/:jwtFromAppwrite`
- **Description**: Verifies the JWT generated by the Appwrite client SDK using the Appwrite Server SDK. If valid, checking if the user exists in the local MongoDB database (creating one if not) and returning a custom backend JWT.

**Request:**

- `Params`:
    - `jwtFromAppwrite`: The JWT string obtained from the Appwrite client SDK on the frontend.

**Example Request:**
```http
POST /v1/auth/jwtVerify/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Example Response (Success):**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsIn...",
    "user": {
      "id": "60d0fe4f5311236168a109ca",
      "email": "user@example.com",
      "name": "Jane Doe"
    }
  },
  "message": "Authentication successful"
}
```

**Example Response (Error):**
```json
{
  "success": false,
  "message": "Invalid token"
}
```

## Project Structure

The project follows a standard Express MVC architecture:

```
src/
├── controllers/    # Request handlers and business logic
├── database/       # Database connection logic
├── environment/    # Environment variable configuration
├── error/          # Error handling middleware and classes
├── interface/      # TypeScript interfaces and types
├── middleware/     # Custom Express middleware
├── models/         # Mongoose schema definitions
├── routes/         # API route definitions
├── services/       # Business logic services (if separated from controllers)
├── utils/          # Utility functions (logger, formatting, etc.)
└── app.ts          # App entry point
```
